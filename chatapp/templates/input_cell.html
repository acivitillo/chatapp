<div class="notebook-entry bg-white rounded-lg shadow-sm border border-gray-100 p-4 mb-6">
  <div class="input-cell relative" id="input-{{ cell_id }}">
    <form
      id="chat-form"
      hx-post="/send/"
      hx-target="#output-{{ cell_id }}"
      hx-swap="outerHTML"
      class="relative mb-4 mt-2"
    >
      <input type="hidden" name="cell_id" value="{{ cell_id }}">
      <div class="relative">
        <textarea
          name="message"
          id="message-input"
          rows="5"
          placeholder="Type a message..."
          class="w-full pr-20 border px-3 py-2 rounded shadow-sm resize-none overflow-hidden leading-relaxed focus:outline-none focus:ring-2 focus:ring-blue-300"
        ></textarea>

        <!-- Buttons Row -->
        <div class="absolute bottom-2 right-2 flex items-center gap-2">
          <div
            class="progress-spinner hidden animate-spin h-6 w-6 rounded-full border-2 border-blue-500 border-t-transparent"
          ></div>
          <!-- New Cell Button -->
          <button
            type="button"
            class="w-8 h-8 rounded-full bg-blue-800 text-white flex items-center justify-center hover:bg-blue-700 shadow"
            title="Insert New Cell"
            hx-get="/new-cell/"
            hx-target=".notebook-entry:last-of-type"
            hx-swap="afterend"
          >
            +
          </button>

          <!-- Send Button -->
          <button
            id="send-button"
            type="submit"
            class="w-8 h-8 rounded-full bg-blue-800 text-white flex items-center justify-center hover:bg-blue-700 shadow"
            title="Send (Ctrl+Enter)"
          >
            â†‘
          </button>
        </div>
      </div>
    </form>
  </div>
  <!-- Empty output cell placeholder -->
  <div id="output-{{ cell_id }}" class="hidden"></div>
</div>

<script>
  function switchTab(cellId, tabName) {
    // Get all tab buttons and contents for this cell
    const outTab = document.getElementById(`tab-out-${cellId}`);
    const codeTab = document.getElementById(`tab-code-${cellId}`);
    const outContent = document.getElementById(`tab-content-out-${cellId}`);
    const codeContent = document.getElementById(`tab-content-code-${cellId}`);
    
    // Reset all tabs
    outTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-500', 'bg-white');
    codeTab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-500', 'bg-white');
    outTab.classList.add('text-gray-500');
    codeTab.classList.add('text-gray-500');
    
    // Hide all content
    outContent.classList.add('hidden');
    codeContent.classList.add('hidden');
    
    // Activate selected tab
    if (tabName === 'out') {
      outTab.classList.remove('text-gray-500');
      outTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-500', 'bg-white');
      outContent.classList.remove('hidden');
    } else {
      codeTab.classList.remove('text-gray-500');
      codeTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-500', 'bg-white');
      codeContent.classList.remove('hidden');
    }
  }
</script>
